<html class="no-js" lang="en" style="font-size: 100px;" data-dpr="1">
<style type="text/css" id="s1930-0">
    ._2oarX {
        width: 108.48px;
        width: 6.78rem;
        margin: 0 auto 6.4px;
        margin: 0 auto .4rem;
        font-size: 3.84px;
        font-size: .24rem;
        line-height: 3.84px;
        line-height: .24rem;
        color: #a85d1b;
        -webkit-border-radius: .08rem;
        -moz-border-radius: .08rem;
        border-radius: .08rem;
        background-color: #fffaee;
        -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .05);
        -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, .05);
        box-shadow: 0 1px 0 rgba(0, 0, 0, .05)
    }

    ._2e8va {
        margin-top: 9.6px;
        margin-top: .6rem;
        position: relative;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        height: 31.04px;
        height: 1.94rem;
        padding: 4.64px 6.4px 0;
        padding: .29rem .4rem 0;
        background-repeat: no-repeat;
        -webkit-background-size: 100% 100%;
        -moz-background-size: 100% 100%;
        background-size: 100% 100%;
        background-image: url("https://ydschool-video.nosdn.127.net/1723517353937bg%403x.png");
        overflow: hidden
    }

    .HBDv2 {
        position: absolute;
        text-align: center;
        top: 10.88px;
        top: .68rem;
        right: 6.4px;
        right: .4rem;
        color: #fff;
        font-size: 4.8px;
        font-size: .3rem;
        width: 29.12px;
        width: 1.82rem;
        height: 11.68px;
        height: .73rem;
        line-height: 11.68px;
        line-height: .73rem;
        -webkit-border-radius: .08rem;
        -moz-border-radius: .08rem;
        border-radius: .08rem;
        background-color: #fb4a3e
    }

    ._25xQG {
        background-color: #ff9830
    }

    ._1_BXz {
        margin-bottom: 1.76px;
        margin-bottom: .11rem;
        max-width: 63.04px;
        max-width: 3.94rem;
        overflow: hidden;
        white-space: nowrap;
        -o-text-overflow: ellipsis;
        text-overflow: ellipsis;
        line-height: 4.16px;
        line-height: .26rem
    }

    ._2Dm6f {
        max-width: 63.04px;
        max-width: 3.94rem;
        overflow: hidden;
        white-space: nowrap;
        -o-text-overflow: ellipsis;
        text-overflow: ellipsis;
        line-height: 4.16px;
        line-height: .26rem
    }

    ._1jCFl {
        font-size: 12.8px;
        font-size: .8rem;
        line-height: 12.8px;
        line-height: .8rem
    }

    ._1_-8f {
        font-weight: 600;
        display: inline-block;
        font-weight: 500;
        font-size: 6.4px;
        font-size: .4rem;
        line-height: 6.4px;
        line-height: .4rem;
        margin-right: .8px;
        margin-right: .05rem
    }

    ._2CqLR {
        padding: 4.48px 4.88px 3.52px 6.4px;
        padding: .28rem .305rem .22rem .4rem;
        color: #cc9a5e;
        -webkit-border-radius: .08rem;
        -moz-border-radius: .08rem;
        border-radius: .08rem
    }

    ._3a3Es {
        display: inline-block;
        line-height: 1.5;
        margin-top: -.96px;
        margin-top: -.06rem;
        max-width: 84.8px;
        max-width: 5.3rem;
        overflow: hidden;
        -o-text-overflow: ellipsis;
        text-overflow: ellipsis;
        word-wrap: break-word;
        white-space: pre-wrap
    }

    p {
        orphans: 3;
        widows: 3;
        margin: 0;
        padding: 0
    }

    .disabled {
        pointer-events: none;
        background-color: gray;
    }
</style>
<script>
    lingquan = () =>
    {
        target = document.querySelector('.HBDv2');
        target.className = 'HBDv2 _25xQG';
        target.innerText = '已领取';
        window.setTimeout(() =>
        {
            history.back();
        }, 700);
    }

    const appId = 'u5pWcozRkszZa6trQkNcHdzG-gzGzoHsz';
    const appKey = '2Ej07YLEQhCqyVWVVYhsWOxc';
    const host = 'u5pwcozr.lc-cn-n1-shared.com';
    const objectId = 'lingquan';
    const url = `https://${host}/1.1/classes/${objectId}`;
    const headers = {
        'X-LC-Id': appId,
        'X-LC-Key': appKey,
        'Content-Type': 'application/json'
    };
    const urlParams = new URLSearchParams(window.location.search);

    // 获取 phone 参数
    const phone = urlParams.get('phone');
    console.log(phone);  // 输出: 12345678901
    async function queryByPhone ()
    {
        const url = `https://${host}/1.1/classes/${objectId}?where={"phone":"${phone}","lingquan":true}`;

        const headers = {
            'X-LC-Id': appId,
            'X-LC-Key': appKey,
            'Content-Type': 'application/json'
        };

        try
        {
            const response = await fetch(url, {
                method: 'GET',
                headers: headers
            });

            if (!response.ok)
            {
                throw new Error('请求失败');
            }

            const data = await response.json();

            if (data.results.length > 0)
            {
                lingquan();
                return data.results;  // 返回查询到的数据
            } else
            {
                console.log('未找到该手机号的数据');
                target = document.querySelector('.HBDv2');
                target.className = 'HBDv2';
                target.innerText = '立即领取';
                return null;
            }
        } catch (error)
        {
            console.error('查询失败:', error);
            return null;
        }
    }
    async function upsertByPhone ()
    {
        const url = `https://${host}/1.1/classes/${objectId}?where={"phone":"${phone}"}`;
        const headers = {
            'X-LC-Id': appId,
            'X-LC-Key': appKey,
            'Content-Type': 'application/json'
        };

        try
        {
            // Step 1: 查询是否已存在该手机号
            const response = await fetch(url, {
                method: 'GET',
                headers: headers
            });

            if (!response.ok)
            {
                throw new Error('查询失败');
            }

            const data = await response.json();

            // Step 2: 如果存在记录，则使用 PUT 更新；如果不存在，则使用 POST 添加新记录
            if (data.results.length > 0)
            {
                // 记录已存在，执行更新
                const objectIdToUpdate = data.results[0].objectId;  // 获取要更新的记录的 objectId
                const updateUrl = `https://${host}/1.1/classes/${objectId}/${objectIdToUpdate}`;
                const body = JSON.stringify({
                    lingquan: true
                });

                const updateResponse = await fetch(updateUrl, {
                    method: 'PUT',
                    headers: headers,
                    body: body
                });

                if (!updateResponse.ok)
                {
                    throw new Error('更新失败');
                }

                const updatedData = await updateResponse.json();
                console.log('更新成功:', updatedData);
                lingquan();
                return updatedData;
            } else
            {
                // 记录不存在，执行添加
                const createUrl = `https://${host}/1.1/classes/${objectId}`;
                const body = JSON.stringify({
                    phone: phone,
                    lingquan: true
                });

                const createResponse = await fetch(createUrl, {
                    method: 'POST',
                    headers: headers,
                    body: body
                });

                if (!createResponse.ok)
                {
                    throw new Error('添加失败');
                }

                const createdData = await createResponse.json();
                console.log('添加成功:', createdData);
                lingquan();
                return createdData;
            }
        } catch (error)
        {
            console.error('操作失败:', error);
            return null;
        }
    }
    window.onload = () =>
    {
        queryByPhone()

    }
</script>
<div class="_2oarX _1_d9c" style="margin-top: 0px;">
    <div class="_2e8va">
        <p class="_1_BXz false"><strong class="_1jCFl"><span
                    class="_1_-8f">¥</span><span>1598</span></strong><span>（满8398.00可用）</span></p>
        <p class="_2Dm6f">有效期：2024.12.08-2024.12.08</p><a onclick="upsertByPhone()">
            <div class="HBDv2 disabled">请稍等...</div>
        </a>
    </div>
    <div class="_2CqLR">
        <div class="_3a3Es">指定课程范围:《信息学备战全程规划C++编程进阶班C3》《信息学备战全程规划C++编程冲刺班C4》<br></div>
    </div>
</div>
</html>
